# 渲染

渲染将您编写的代码转换为用户界面。React 和 Next.js 允许您创建混合 web 应用程序，其中部分代码可以在服务器或客户端上渲染。本节将帮助您理解这些渲染环境、策略和运行时之间的差异。

### 基础知识

首先，熟悉三个基础 web 概念是有帮助的：

* 您的应用程序代码可以执行的[环境](https://nextjs.org/docs/app/building-your-application/rendering#rendering-environments)：服务器和客户端。
* 当用户访问或与您的应用程序交互时启动的[请求-响应生命周期](https://nextjs.org/docs/app/building-your-application/rendering#request-response-lifecycle)。
* 分隔服务器和客户端代码的[网络边界](https://nextjs.org/docs/app/building-your-application/rendering#network-boundary)。

#### 渲染环境

有两个环境可以渲染 Web 应用程序：客户端和服务器。

<figure><img src="../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

* **客户端**指的是用户设备上的浏览器，它向服务器发送请求以获取您的应用程序代码。然后，它将服务器的响应转换为用户界面。
* **服务器**指的是数据中心中的计算机，它存储您的应用程序代码，接收来自客户端的请求，并发送适当的响应。

历史上，开发人员在为服务器和客户端编写代码时必须使用不同的语言（例如 JavaScript、PHP）和框架。使用 React，开发人员可以使用相同的语言（JavaScript）和相同的框架（例如 Next.js 或您选择的框架）。这种灵活性使您能够无缝地为两个环境编写代码，而无需上下文切换。

然而，每个环境都有其自身的能力和限制。因此，您为服务器和客户端编写的代码并不总是相同的。有些操作（例如数据获取或管理用户状态）更适合某个环境。

理解这些差异是有效使用 React 和 Next.js 的关键。我们将在服务器和客户端组件页面上更详细地讨论这些差异和用例，现在，让我们继续在我们的基础上构建。

#### 请求-响应生命周期

广义上讲，所有网站都遵循相同的**请求-响应生命周期**：

1. **用户操作**：用户与 web 应用程序交互。这可能是点击链接、提交表单或直接在浏览器的地址栏中输入 URL。
2. **HTTP 请求**：客户端向服务器发送 HTTP 请求，其中包含有关请求哪些资源、使用了什么方法（例如 `GET` 、 `POST` ）以及必要时的其他数据的必要信息。
3. **服务器**：服务器处理请求并以适当的资源响应。此过程可能需要几个步骤，例如路由、获取数据等。
4. **HTTP 响应**：在处理请求后，服务器将 HTTP 响应发送回客户端。此响应包含状态码（告诉客户端请求是否成功）和请求的资源（例如 HTML、CSS、JavaScript、静态资产等）。
5. **客户端**：客户端解析资源以渲染用户界面。
6. **用户操作**：一旦用户界面被渲染，用户可以与之交互，整个过程再次开始。

构建混合 web 应用程序的一个主要部分是决定如何在生命周期中拆分工作，以及在哪里放置网络边界。

#### 网络边界

在网页开发中，网络边界[^1]是一个概念性界限，用于分隔不同的环境。例如，客户端和服务器，或服务器和数据存储。

在 React 中，您可以选择在最合适的地方放置客户端-服务器网络边界。

在幕后，工作分为两个部分：**客户端模块图**和**服务器模块图**。服务器模块图包含在服务器上渲染的所有组件，而客户端模块图包含在客户端上渲染的所有组件。

将模块图视为应用程序中文件相互依赖的可视化表示可能会很有帮助。

您可以使用 React `"use client"` 约定来定义边界。还有一个 `"use server"` 约定，它告诉 React 在服务器上进行一些计算工作。

### 构建混合应用程序

在这些环境中工作时，考虑应用程序中代码的流动是单向的，这很有帮助。换句话说，在响应期间，您的应用程序代码以一个方向流动：从服务器到客户端。

如果您需要从客户端访问服务器，您需要向服务器发送一个新请求，而不是重用相同的请求。这使得理解在哪里渲染组件以及在哪里放置网络边界变得更容易。

在实践中，这种模型鼓励开发人员首先考虑他们想要在服务器上执行的操作，然后再将结果发送到客户端，使应用程序变得互动。

当我们查看如何在同一组件树中[交错客户端和服务器组件](https://nextjs.org/docs/app/building-your-application/rendering/composition-patterns)时，这个概念会变得更加清晰。

[^1]: 在前端开发中，**网络边界**通常指 **前端和后端 API 之间的交互。**
